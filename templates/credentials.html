{{ template "head.html" . }}

<h2>Credential Management</h2>

<div style="margin-bottom: 20px;">
    <h3>Existing Credentials</h3>
    {{ if .Aliases }}
    <table>
        <tr>
            <th>Alias</th>
            <th>Action</th>
        </tr>
        {{ range .Aliases }}
        <tr>
            <td>{{ . }}</td>
            <td>
                <form method="POST" action="/credentials/delete" style="display:inline;" onsubmit="return confirm('Are you sure?');">
                    <input type="hidden" name="alias" value="{{ . }}">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        {{ end }}
    </table>
    {{ else }}
    <p>No credentials stored.</p>
    {{ end }}
</div>

<div style="border-top: 1px solid #ddd; padding-top: 20px;">
    <h3>Add/Update Credentials</h3>
    <form method="POST" action="/credentials" id="credForm">
        <div style="margin-bottom: 10px;">
            <label><strong>Alias:</strong> <input type="text" name="alias" placeholder="e.g. mys3 (optional)"></label>
            <p style="font-size: 0.9em; color: #666;">If left empty, a random alias will be generated.</p>
        </div>

        <h4>Configuration</h4>
        <div id="fields">
            <div class="field-row">
                <input type="text" name="keys[]" placeholder="Key" value="type" required>
                <input type="text" name="values[]" placeholder="Value" value="s3" required>
                <button type="button" onclick="removeRow(this)">Remove</button>
            </div>
             <div class="field-row">
                <input type="text" name="keys[]" placeholder="Key" value="provider">
                <input type="text" name="values[]" placeholder="Value" value="AWS">
                <button type="button" onclick="removeRow(this)">Remove</button>
            </div>
             <div class="field-row">
                <input type="text" name="keys[]" placeholder="Key" value="access_key_id">
                <input type="text" name="values[]" placeholder="Value">
                <button type="button" onclick="removeRow(this)">Remove</button>
            </div>
             <div class="field-row">
                <input type="text" name="keys[]" placeholder="Key" value="secret_access_key">
                <input type="password" name="values[]" placeholder="Value">
                <button type="button" onclick="removeRow(this)">Remove</button>
            </div>
        </div>
        <button type="button" onclick="addRow()">+ Add Field</button>
        <br><br>
        <button type="submit">Save Credentials</button>
    </form>
</div>

<script>
function addRow() {
    const div = document.createElement('div');
    div.className = 'field-row';
    div.innerHTML = `
        <input type="text" name="keys[]" placeholder="Key">
        <input type="text" name="values[]" placeholder="Value">
        <button type="button" onclick="removeRow(this)">Remove</button>
    `;
    document.getElementById('fields').appendChild(div);
}

function removeRow(btn) {
    btn.parentNode.remove();
}
</script>

<style>
    .field-row { margin-bottom: 5px; }
    .field-row input { margin-right: 5px; padding: 5px; }
    .field-row button { padding: 5px; }
</style>

{{ template "foot.html" . }}
